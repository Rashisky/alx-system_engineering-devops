global
    log /dev/log local0
    user ubuntu
    group ubuntu
    maxconn 1024
    tune.ssl.default-dh-param 2048

defaults
    log global
    mode http
    option httplog
    option http-server-close
    option forwardfor
    timeout connect 15000
    retries 3
    timeout client 30000
    timeout server 20000

frontend my_http
    bind *:80
    http-request set-path /
    redirect scheme https if !{ ssl_fc }
    default_backend my_http_backend

frontend my_https
    bind *:443 ssl crt /etc/haproxy/certs/lb-01.adejare.tech.pem
    acl my_cond path_beg /~
    use_backend my_root_backend if my_cond
    default_backend my_http_backend


backend my_http_backend
    balance roundrobin
    server web-01 100.24.238.155:80 check
    server web-02 100.25.129.98:80 check

backend my_root_backend
    server my_localhost localhost:80
